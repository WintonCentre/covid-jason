!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t="http://www.w3.org/1999/xhtml",e={svg:"http://www.w3.org/2000/svg",xhtml:t,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function n(t){var n=t+="",r=n.indexOf(":");return r>=0&&"xmlns"!==(n=t.slice(0,r))&&(t=t.slice(r+1)),e.hasOwnProperty(n)?{space:e[n],local:t}:t}function r(e){return function(){var n=this.ownerDocument,r=this.namespaceURI;return r===t&&n.documentElement.namespaceURI===t?n.createElement(e):n.createElementNS(r,e)}}function i(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function a(t){var e=n(t);return(e.local?i:r)(e)}function o(){}function u(t){return null==t?o:function(){return this.querySelector(t)}}function c(){return[]}function s(t){return new Array(t.length)}function l(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}l.prototype={constructor:l,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function f(t,e,n,r,i,a){for(var o,u=0,c=e.length,s=a.length;u<s;++u)(o=e[u])?(o.__data__=a[u],r[u]=o):n[u]=new l(t,a[u]);for(;u<c;++u)(o=e[u])&&(i[u]=o)}function h(t,e,n,r,i,a,o){var u,c,s,f={},h=e.length,d=a.length,p=new Array(h);for(u=0;u<h;++u)(c=e[u])&&(p[u]=s="$"+o.call(c,c.__data__,u,e),s in f?i[u]=c:f[s]=c);for(u=0;u<d;++u)(c=f[s="$"+o.call(t,a[u],u,a)])?(r[u]=c,c.__data__=a[u],f[s]=null):n[u]=new l(t,a[u]);for(u=0;u<h;++u)(c=e[u])&&f[p[u]]===c&&(i[u]=c)}function d(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function p(t){return function(){this.removeAttribute(t)}}function g(t){return function(){this.removeAttributeNS(t.space,t.local)}}function m(t,e){return function(){this.setAttribute(t,e)}}function v(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function y(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function w(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function x(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function M(t){return function(){this.style.removeProperty(t)}}function b(t,e,n){return function(){this.style.setProperty(t,e,n)}}function _(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function C(t,e){return t.style.getPropertyValue(e)||x(t).getComputedStyle(t,null).getPropertyValue(e)}function T(t){return function(){delete this[t]}}function A(t,e){return function(){this[t]=e}}function k(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function D(t){return t.trim().split(/^|\s+/)}function U(t){return t.classList||new N(t)}function N(t){this._node=t,this._names=D(t.getAttribute("class")||"")}function S(t,e){for(var n=U(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function F(t,e){for(var n=U(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function H(t){return function(){S(this,t)}}function E(t){return function(){F(this,t)}}function L(t,e){return function(){(e.apply(this,arguments)?S:F)(this,t)}}function Y(){this.textContent=""}function O(t){return function(){this.textContent=t}}function j(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function V(){this.innerHTML=""}function q(t){return function(){this.innerHTML=t}}function z(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function I(){this.nextSibling&&this.parentNode.appendChild(this)}function R(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function P(){return null}function Z(){var t=this.parentNode;t&&t.removeChild(this)}function B(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function W(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}N.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var X={};"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(X={mouseenter:"mouseover",mouseleave:"mouseout"}));function J(t,e,n){return t=Q(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function Q(t,e,n){return function(r){try{t.call(this,this.__data__,e,n)}finally{}}}function G(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function K(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,a=e.length;r<a;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function tt(t,e,n){var r=X.hasOwnProperty(t.type)?J:Q;return function(i,a,o){var u,c=this.__on,s=r(e,a,o);if(c)for(var l=0,f=c.length;l<f;++l)if((u=c[l]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=s,u.capture=n),void(u.value=e);this.addEventListener(t.type,s,n),u={type:t.type,name:t.name,value:e,listener:s,capture:n},c?c.push(u):this.__on=[u]}}function et(t,e,n){var r=x(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function nt(t,e){return function(){return et(this,t,e)}}function rt(t,e){return function(){return et(this,t,e.apply(this,arguments))}}var it=[null];function at(t,e){this._groups=t,this._parents=e}function ot(t){return"string"==typeof t?new at([[document.querySelector(t)]],[document.documentElement]):new at([[t]],it)}at.prototype={constructor:at,select:function(t){"function"!=typeof t&&(t=u(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a,o,c=e[i],s=c.length,l=r[i]=new Array(s),f=0;f<s;++f)(a=c[f])&&(o=t.call(a,a.__data__,f,c))&&("__data__"in a&&(o.__data__=a.__data__),l[f]=o);return new at(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?c:function(){return this.querySelectorAll(t)}}(t));for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o,u=e[a],s=u.length,l=0;l<s;++l)(o=u[l])&&(r.push(t.call(o,o.__data__,l,u)),i.push(o));return new at(r,i)},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a,o=e[i],u=o.length,c=r[i]=[],s=0;s<u;++s)(a=o[s])&&t.call(a,a.__data__,s,o)&&c.push(a);return new at(r,this._parents)},data:function(t,e){if(!t)return m=new Array(this.size()),l=-1,this.each((function(t){m[++l]=t})),m;var n,r=e?h:f,i=this._parents,a=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=a.length,u=new Array(o),c=new Array(o),s=new Array(o),l=0;l<o;++l){var d=i[l],p=a[l],g=p.length,m=t.call(d,d&&d.__data__,l,i),v=m.length,y=c[l]=new Array(v),w=u[l]=new Array(v);r(d,p,y,w,s[l]=new Array(g),m,e);for(var x,M,b=0,_=0;b<v;++b)if(x=y[b]){for(b>=_&&(_=b+1);!(M=w[_])&&++_<v;);x._next=M||null}}return(u=new at(u,i))._enter=c,u._exit=s,u},enter:function(){return new at(this._enter||this._groups.map(s),this._parents)},exit:function(){return new at(this._exit||this._groups.map(s),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,a=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(i=e(i)),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),u=0;u<a;++u)for(var c,s=e[u],l=n[u],f=s.length,h=o[u]=new Array(f),d=0;d<f;++d)(c=s[d]||l[d])&&(h[d]=c);for(;u<r;++u)o[u]=e[u];return new at(o,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=d);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,u=n[a],c=u.length,s=i[a]=new Array(c),l=0;l<c;++l)(o=u[l])&&(s[l]=o);s.sort(e)}return new at(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,a=e[n],o=0,u=a.length;o<u;++o)(i=a[o])&&t.call(i,i.__data__,o,a);return this},attr:function(t,e){var r=n(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((null==e?r.local?g:p:"function"==typeof e?r.local?w:y:r.local?v:m)(r,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?M:"function"==typeof e?_:b)(t,e,null==n?"":n)):C(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?T:"function"==typeof e?k:A)(t,e)):this.node()[t]},classed:function(t,e){var n=D(t+"");if(arguments.length<2){for(var r=U(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?L:e?H:E)(n,e))},text:function(t){return arguments.length?this.each(null==t?Y:("function"==typeof t?j:O)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?V:("function"==typeof t?z:q)(t)):this.node().innerHTML},raise:function(){return this.each(I)},lower:function(){return this.each(R)},append:function(t){var e="function"==typeof t?t:a(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:a(t),r=null==e?P:"function"==typeof e?e:u(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Z)},clone:function(t){return this.select(t?W:B)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,a=G(t+""),o=a.length;if(!(arguments.length<2)){for(u=e?tt:K,null==n&&(n=!1),r=0;r<o;++r)this.each(u(a[r],e,n));return this}var u=this.node().__on;if(u)for(var c,s=0,l=u.length;s<l;++s)for(r=0,c=u[s];r<o;++r)if((i=a[r]).type===c.type&&i.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?rt:nt)(t,e))}};var ut={},ct={};function st(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function lt(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function ft(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function ht(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+ft(-t,6):t>9999?"+"+ft(t,6):ft(t,4)}(t.getUTCFullYear())+"-"+ft(t.getUTCMonth()+1,2)+"-"+ft(t.getUTCDate(),2)+(i?"T"+ft(e,2)+":"+ft(n,2)+":"+ft(r,2)+"."+ft(i,3)+"Z":r?"T"+ft(e,2)+":"+ft(n,2)+":"+ft(r,2)+"Z":n||e?"T"+ft(e,2)+":"+ft(n,2)+"Z":"")}var dt=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],a=t.length,o=0,u=0,c=a<=0,s=!1;function l(){if(c)return ct;if(s)return s=!1,ut;var e,r,i=o;if(34===t.charCodeAt(i)){for(;o++<a&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=a?c=!0:10===(r=t.charCodeAt(o++))?s=!0:13===r&&(s=!0,10===t.charCodeAt(o)&&++o),t.slice(i+1,e-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=t.charCodeAt(e=o++)))s=!0;else if(13===r)s=!0,10===t.charCodeAt(o)&&++o;else if(r!==n)continue;return t.slice(i,e)}return c=!0,t.slice(i,a)}for(10===t.charCodeAt(a-1)&&--a,13===t.charCodeAt(a-1)&&--a;(r=l())!==ct;){for(var f=[];r!==ut&&r!==ct;)f.push(r),r=l();e&&null==(f=e(f,u++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return o(e[t])})).join(t)}))}function a(e){return e.map(o).join(t)}function o(t){return null==t?"":t instanceof Date?ht(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,a=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=st(t);return function(r,i){return e(n(r),i,t)}}(t,e):st(t)}));return a.columns=i||[],a},parseRows:r,format:function(e,n){return null==n&&(n=lt(e)),[n.map(o).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=lt(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(a).join("\n")},formatRow:a,formatValue:o}}(",").parse;function pt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function gt(t){var e;return 1===t.length&&(e=t,t=function(t,n){return pt(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}var mt=gt(pt).right;function vt(t){return t}function yt(t,e,...n){return function(t,e,n,r){return function t(i,a){if(a>=r.length)return n(i);const o=new Map,u=r[a++];let c=-1;for(const t of i){const e=u(t,++c,i),n=o.get(e);n?n.push(t):o.set(e,[t])}for(const[e,n]of o)o.set(e,t(n,a));return e(o)}(t,0)}(t,vt,e,n)}var wt=Math.sqrt(50),xt=Math.sqrt(10),Mt=Math.sqrt(2);function bt(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=wt?10:a>=xt?5:a>=Mt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=wt?10:a>=xt?5:a>=Mt?2:1)}function _t(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=wt?i*=10:a>=xt?i*=5:a>=Mt&&(i*=2),e<t?-i:i}function Ct(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function Tt(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function At(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function kt(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Dt(){}var Ut="\\s*([+-]?\\d+)\\s*",Nt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",St="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ft=/^#([0-9a-f]{3,8})$/,Ht=new RegExp("^rgb\\("+[Ut,Ut,Ut]+"\\)$"),Et=new RegExp("^rgb\\("+[St,St,St]+"\\)$"),Lt=new RegExp("^rgba\\("+[Ut,Ut,Ut,Nt]+"\\)$"),Yt=new RegExp("^rgba\\("+[St,St,St,Nt]+"\\)$"),Ot=new RegExp("^hsl\\("+[Nt,St,St]+"\\)$"),jt=new RegExp("^hsla\\("+[Nt,St,St,Nt]+"\\)$"),Vt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function $t(){return this.rgb().formatHex()}function qt(){return this.rgb().formatRgb()}function zt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ft.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?It(e):3===n?new Bt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Rt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Rt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ht.exec(t))?new Bt(e[1],e[2],e[3],1):(e=Et.exec(t))?new Bt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Lt.exec(t))?Rt(e[1],e[2],e[3],e[4]):(e=Yt.exec(t))?Rt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ot.exec(t))?Qt(e[1],e[2]/100,e[3]/100,1):(e=jt.exec(t))?Qt(e[1],e[2]/100,e[3]/100,e[4]):Vt.hasOwnProperty(t)?It(Vt[t]):"transparent"===t?new Bt(NaN,NaN,NaN,0):null}function It(t){return new Bt(t>>16&255,t>>8&255,255&t,1)}function Rt(t,e,n,r){return r<=0&&(t=e=n=NaN),new Bt(t,e,n,r)}function Pt(t){return t instanceof Dt||(t=zt(t)),t?new Bt((t=t.rgb()).r,t.g,t.b,t.opacity):new Bt}function Zt(t,e,n,r){return 1===arguments.length?Pt(t):new Bt(t,e,n,null==r?1:r)}function Bt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Wt(){return"#"+Jt(this.r)+Jt(this.g)+Jt(this.b)}function Xt(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Jt(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Qt(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Kt(t,e,n,r)}function Gt(t){if(t instanceof Kt)return new Kt(t.h,t.s,t.l,t.opacity);if(t instanceof Dt||(t=zt(t)),!t)return new Kt;if(t instanceof Kt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,u=a-i,c=(a+i)/2;return u?(o=e===a?(n-r)/u+6*(n<r):n===a?(r-e)/u+2:(e-n)/u+4,u/=c<.5?a+i:2-a-i,o*=60):u=c>0&&c<1?0:o,new Kt(o,u,c,t.opacity)}function Kt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function te(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function ee(t){return function(){return t}}function ne(t){return 1==(t=+t)?re:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):ee(isNaN(e)?n:e)}}function re(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):ee(isNaN(t)?e:t)}At(Dt,zt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:$t,formatHex:$t,formatHsl:function(){return Gt(this).formatHsl()},formatRgb:qt,toString:qt}),At(Bt,Zt,kt(Dt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Bt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Bt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Wt,formatHex:Wt,formatRgb:Xt,toString:Xt})),At(Kt,(function(t,e,n,r){return 1===arguments.length?Gt(t):new Kt(t,e,n,null==r?1:r)}),kt(Dt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Kt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Kt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Bt(te(t>=240?t-240:t+120,i,r),te(t,i,r),te(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var ie=function t(e){var n=ne(e);function r(t,e){var r=n((t=Zt(t)).r,(e=Zt(e)).r),i=n(t.g,e.g),a=n(t.b,e.b),o=re(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=a(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function ae(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(a){for(n=0;n<r;++n)i[n]=t[n]*(1-a)+e[n]*a;return i}}function oe(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=de(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<i;++n)o[n]=a[n](t);return o}}function ue(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ce(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function se(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=de(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var le=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fe=new RegExp(le.source,"g");function he(t,e){var n,r,i,a=le.lastIndex=fe.lastIndex=0,o=-1,u=[],c=[];for(t+="",e+="";(n=le.exec(t))&&(r=fe.exec(e));)(i=r.index)>a&&(i=e.slice(a,i),u[o]?u[o]+=i:u[++o]=i),(n=n[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,c.push({i:o,x:ce(n,r)})),a=fe.lastIndex;return a<e.length&&(i=e.slice(a),u[o]?u[o]+=i:u[++o]=i),u.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,r=0;r<e;++r)u[(n=c[r]).i]=n.x(t);return u.join("")})}function de(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?ee(e):("number"===i?ce:"string"===i?(n=zt(e))?(e=n,ie):he:e instanceof zt?ie:e instanceof Date?ue:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?oe:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?se:ce:ae))(t,e)}function pe(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function ge(t){return+t}var me=[0,1];function ve(t){return t}function ye(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function we(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=ye(i,r),a=n(o,a)):(r=ye(r,i),a=n(a,o)),function(t){return a(r(t))}}function xe(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=ye(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(e){var n=mt(t,e,1,r)-1;return a[n](i[n](e))}}function Me(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function be(){var t,e,n,r,i,a,o=me,u=me,c=de,s=ve;function l(){var t,e,n,c=Math.min(o.length,u.length);return s!==ve&&(t=o[0],e=o[c-1],t>e&&(n=t,t=e,e=n),s=function(n){return Math.max(t,Math.min(e,n))}),r=c>2?xe:we,i=a=null,f}function f(e){return isNaN(e=+e)?n:(i||(i=r(o.map(t),u,c)))(t(s(e)))}return f.invert=function(n){return s(e((a||(a=r(u,o.map(t),ce)))(n)))},f.domain=function(t){return arguments.length?(o=Array.from(t,ge),l()):o.slice()},f.range=function(t){return arguments.length?(u=Array.from(t),l()):u.slice()},f.rangeRound=function(t){return u=Array.from(t),c=pe,l()},f.clamp=function(t){return arguments.length?(s=!!t||ve,l()):s!==ve},f.interpolate=function(t){return arguments.length?(c=t,l()):c},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,l()}}function _e(){return be()(ve,ve)}function Ce(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Te(t){return(t=Ce(Math.abs(t)))?t[1]:NaN}var Ae,ke=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function De(t){if(!(e=ke.exec(t)))throw new Error("invalid format: "+t);var e;return new Ue({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Ue(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Ne(t,e){var n=Ce(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}De.prototype=Ue.prototype,Ue.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Se={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Ne(100*t,e)},r:Ne,s:function(t,e){var n=Ce(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(Ae=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Ce(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function Fe(t){return t}var He,Ee,Le,Ye=Array.prototype.map,Oe=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function je(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Fe:(e=Ye.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,a=[],o=0,u=e[0],c=0;i>0&&u>0&&(c+u+1>r&&(u=Math.max(1,r-c)),a.push(t.substring(i-=u,i+u)),!((c+=u+1)>r));)u=e[o=(o+1)%e.length];return a.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",u=void 0===t.numerals?Fe:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Ye.call(t.numerals,String)),c=void 0===t.percent?"%":t.percent+"",s=void 0===t.minus?"-":t.minus+"",l=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=De(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,v=t.trim,y=t.type;"n"===y?(g=!0,y="g"):Se[y]||(void 0===m&&(m=12),v=!0,y="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var w="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?a:/[%p]/.test(y)?c:"",M=Se[y],b=/[defgprs%]/.test(y);function _(t){var i,a,c,h=w,_=x;if("c"===y)_=M(t)+_,t="";else{var C=(t=+t)<0||1/t<0;if(t=isNaN(t)?l:M(Math.abs(t),m),v&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),C&&0==+t&&"+"!==f&&(C=!1),h=(C?"("===f?f:s:"-"===f||"("===f?"":f)+h,_=("s"===y?Oe[8+Ae/3]:"")+_+(C&&"("===f?")":""),b)for(i=-1,a=t.length;++i<a;)if(48>(c=t.charCodeAt(i))||c>57){_=(46===c?o+t.slice(i+1):t.slice(i))+_,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var T=h.length+t.length+_.length,A=T<p?new Array(p-T+1).join(e):"";switch(g&&d&&(t=r(A+t,A.length?p-_.length:1/0),A=""),n){case"<":t=h+t+_+A;break;case"=":t=h+A+t+_;break;case"^":t=A.slice(0,T=A.length>>1)+h+t+_+A.slice(T);break;default:t=A+h+t+_}return u(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),_.toString=function(){return t+""},_}return{format:f,formatPrefix:function(t,e){var n=f(((t=De(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Te(e)/3))),i=Math.pow(10,-r),a=Oe[8+r/3];return function(t){return n(i*t)+a}}}}function Ve(t,e,n,r){var i,a=_t(t,e,n);switch((r=De(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Te(e)/3)))-Te(Math.abs(t)))}(a,o))||(r.precision=i),Le(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Te(e)-Te(t))+1}(a,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Te(Math.abs(t)))}(a))||(r.precision=i-2*("%"===r.type))}return Ee(r)}function $e(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,i,a,o,u=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(o=bt(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),a=new Array(i=Math.ceil(e-t+1));++u<i;)a[u]=(t+u)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),a=new Array(i=Math.ceil(t-e+1));++u<i;)a[u]=(t-u)/o;return r&&a.reverse(),a}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Ve(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),a=0,o=i.length-1,u=i[a],c=i[o];return c<u&&(r=u,u=c,c=r,r=a,a=o,o=r),(r=bt(u,c,n))>0?r=bt(u=Math.floor(u/r)*r,c=Math.ceil(c/r)*r,n):r<0&&(r=bt(u=Math.ceil(u*r)/r,c=Math.floor(c*r)/r,n)),r>0?(i[a]=Math.floor(u/r)*r,i[o]=Math.ceil(c/r)*r,e(i)):r<0&&(i[a]=Math.ceil(u*r)/r,i[o]=Math.floor(c*r)/r,e(i)),t},t}function qe(){var t=_e();return t.copy=function(){return Me(t,qe())},Tt.apply(t,arguments),$e(t)}He=je({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Ee=He.format,Le=He.formatPrefix;var ze=new Date,Ie=new Date;function Re(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,a){var o,u=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return u;do{u.push(o=new Date(+n)),e(n,a),t(n)}while(o<n&&n<r);return u},i.filter=function(n){return Re((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return ze.setTime(+e),Ie.setTime(+r),t(ze),t(Ie),Math.floor(n(ze,Ie))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var Pe=Re((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Pe.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Re((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Pe:null};var Ze=Re((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),Be=Re((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}));function We(t){return Re((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var Xe=We(0),Je=We(1);We(2),We(3);var Qe=We(4);We(5),We(6);var Ge=Re((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));Ge.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Re((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var Ke=Re((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()})),tn=Re((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),en=Re((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}));function nn(t){return Re((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var rn=nn(0),an=nn(1);nn(2),nn(3);var on=nn(4);nn(5),nn(6);var un=Re((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})),cn=Re((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));function sn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ln(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function fn(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}cn.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Re((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var hn,dn,pn,gn={"-":"",_:" ",0:"0"},mn=/^\s*\d+/,vn=/^%/,yn=/[\\^$*+?|[\]().{}]/g;function wn(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(e)+i:i)}function xn(t){return t.replace(yn,"\\$&")}function Mn(t){return new RegExp("^(?:"+t.map(xn).join("|")+")","i")}function bn(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function _n(t,e,n){var r=mn.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Cn(t,e,n){var r=mn.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Tn(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function An(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function kn(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function Dn(t,e,n){var r=mn.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Un(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Nn(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Sn(t,e,n){var r=mn.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function Fn(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Hn(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function En(t,e,n){var r=mn.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Ln(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Yn(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function On(t,e,n){var r=mn.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function jn(t,e,n){var r=mn.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Vn(t,e,n){var r=mn.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function $n(t,e,n){var r=vn.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function qn(t,e,n){var r=mn.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function zn(t,e,n){var r=mn.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function In(t,e){return wn(t.getDate(),e,2)}function Rn(t,e){return wn(t.getHours(),e,2)}function Pn(t,e){return wn(t.getHours()%12||12,e,2)}function Zn(t,e){return wn(1+Be.count(Ge(t),t),e,3)}function Bn(t,e){return wn(t.getMilliseconds(),e,3)}function Wn(t,e){return Bn(t,e)+"000"}function Xn(t,e){return wn(t.getMonth()+1,e,2)}function Jn(t,e){return wn(t.getMinutes(),e,2)}function Qn(t,e){return wn(t.getSeconds(),e,2)}function Gn(t){var e=t.getDay();return 0===e?7:e}function Kn(t,e){return wn(Xe.count(Ge(t)-1,t),e,2)}function tr(t,e){var n=t.getDay();return t=n>=4||0===n?Qe(t):Qe.ceil(t),wn(Qe.count(Ge(t),t)+(4===Ge(t).getDay()),e,2)}function er(t){return t.getDay()}function nr(t,e){return wn(Je.count(Ge(t)-1,t),e,2)}function rr(t,e){return wn(t.getFullYear()%100,e,2)}function ir(t,e){return wn(t.getFullYear()%1e4,e,4)}function ar(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+wn(e/60|0,"0",2)+wn(e%60,"0",2)}function or(t,e){return wn(t.getUTCDate(),e,2)}function ur(t,e){return wn(t.getUTCHours(),e,2)}function cr(t,e){return wn(t.getUTCHours()%12||12,e,2)}function sr(t,e){return wn(1+en.count(cn(t),t),e,3)}function lr(t,e){return wn(t.getUTCMilliseconds(),e,3)}function fr(t,e){return lr(t,e)+"000"}function hr(t,e){return wn(t.getUTCMonth()+1,e,2)}function dr(t,e){return wn(t.getUTCMinutes(),e,2)}function pr(t,e){return wn(t.getUTCSeconds(),e,2)}function gr(t){var e=t.getUTCDay();return 0===e?7:e}function mr(t,e){return wn(rn.count(cn(t)-1,t),e,2)}function vr(t,e){var n=t.getUTCDay();return t=n>=4||0===n?on(t):on.ceil(t),wn(on.count(cn(t),t)+(4===cn(t).getUTCDay()),e,2)}function yr(t){return t.getUTCDay()}function wr(t,e){return wn(an.count(cn(t)-1,t),e,2)}function xr(t,e){return wn(t.getUTCFullYear()%100,e,2)}function Mr(t,e){return wn(t.getUTCFullYear()%1e4,e,4)}function br(){return"+0000"}function _r(){return"%"}function Cr(t){return+t}function Tr(t){return Math.floor(+t/1e3)}!function(t){(hn=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,a=t.days,o=t.shortDays,u=t.months,c=t.shortMonths,s=Mn(i),l=bn(i),f=Mn(a),h=bn(a),d=Mn(o),p=bn(o),g=Mn(u),m=bn(u),v=Mn(c),y=bn(c),w={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return c[t.getMonth()]},B:function(t){return u[t.getMonth()]},c:null,d:In,e:In,f:Wn,H:Rn,I:Pn,j:Zn,L:Bn,m:Xn,M:Jn,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Cr,s:Tr,S:Qn,u:Gn,U:Kn,V:tr,w:er,W:nr,x:null,X:null,y:rr,Y:ir,Z:ar,"%":_r},x={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return c[t.getUTCMonth()]},B:function(t){return u[t.getUTCMonth()]},c:null,d:or,e:or,f:fr,H:ur,I:cr,j:sr,L:lr,m:hr,M:dr,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Cr,s:Tr,S:pr,u:gr,U:mr,V:vr,w:yr,W:wr,x:null,X:null,y:xr,Y:Mr,Z:br,"%":_r},M={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return C(t,e,n,r)},d:Hn,e:Hn,f:Vn,H:Ln,I:Ln,j:En,L:jn,m:Fn,M:Yn,p:function(t,e,n){var r=s.exec(e.slice(n));return r?(t.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:Sn,Q:qn,s:zn,S:On,u:Cn,U:Tn,V:An,w:_n,W:kn,x:function(t,e,r){return C(t,n,e,r)},X:function(t,e,n){return C(t,r,e,n)},y:Un,Y:Dn,Z:Nn,"%":$n};function b(t,e){return function(n){var r,i,a,o=[],u=-1,c=0,s=t.length;for(n instanceof Date||(n=new Date(+n));++u<s;)37===t.charCodeAt(u)&&(o.push(t.slice(c,u)),null!=(i=gn[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(a=e[r])&&(r=a(n,i)),o.push(r),c=u+1);return o.push(t.slice(c,u)),o.join("")}}function _(t,e){return function(n){var r,i,a=fn(1900,void 0,1);if(C(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(e&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=ln(fn(a.y,0,1))).getUTCDay(),r=i>4||0===i?an.ceil(r):an(r),r=en.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=sn(fn(a.y,0,1))).getDay(),r=i>4||0===i?Je.ceil(r):Je(r),r=Be.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?ln(fn(a.y,0,1)).getUTCDay():sn(fn(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,ln(a)):sn(a)}}function C(t,e,n,r){for(var i,a,o=0,u=e.length,c=n.length;o<u;){if(r>=c)return-1;if(37===(i=e.charCodeAt(o++))){if(i=e.charAt(o++),!(a=M[i in gn?e.charAt(o++):i])||(r=a(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return w.x=b(n,w),w.X=b(r,w),w.c=b(e,w),x.x=b(n,x),x.X=b(r,x),x.c=b(e,x),{format:function(t){var e=b(t+="",w);return e.toString=function(){return t},e},parse:function(t){var e=_(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=b(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=_(t+="",!0);return e.toString=function(){return t},e}}}(t)).format,hn.parse,dn=hn.utcFormat,pn=hn.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ar(t){return new Date(t)}function kr(t){return t instanceof Date?+t:+new Date(+t)}function Dr(t,e,n,r,i,a,o,u,c){var s=_e(),l=s.invert,f=s.domain,h=c(".%L"),d=c(":%S"),p=c("%I:%M"),g=c("%I %p"),m=c("%a %d"),v=c("%b %d"),y=c("%B"),w=c("%Y"),x=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function M(u){return(o(u)<u?h:a(u)<u?d:i(u)<u?p:r(u)<u?g:e(u)<u?n(u)<u?m:v:t(u)<u?y:w)(u)}function b(e,n,r){if(null==e&&(e=10),"number"==typeof e){var i,a=Math.abs(r-n)/e,o=gt((function(t){return t[2]})).right(x,a);return o===x.length?(i=_t(n/31536e6,r/31536e6,e),e=t):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],e=o[0]):(i=Math.max(_t(n,r,e),1),e=u),e.every(i)}return e}return s.invert=function(t){return new Date(l(t))},s.domain=function(t){return arguments.length?f(Array.from(t,kr)):f().map(Ar)},s.ticks=function(t){var e,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(e=r,r=i,i=e),e=(e=b(t,r,i))?e.range(r,i+1):[],a?e.reverse():e},s.tickFormat=function(t,e){return null==e?M:c(e)},s.nice=function(t){var e=f();return(t=b(t,e[0],e[e.length-1]))?f(function(t,e){var n,r=0,i=(t=t.slice()).length-1,a=t[r],o=t[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),t[r]=e.floor(a),t[i]=e.ceil(o),t}(e,t)):s},s.copy=function(){return Me(s,Dr(t,e,n,r,i,a,o,u,c))},s}var Ur=Array.prototype.slice;function Nr(t){return t}function Sr(t){return"translate("+(t+.5)+",0)"}function Fr(t){return"translate(0,"+(t+.5)+")"}function Hr(t){return function(e){return+t(e)}}function Er(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function Lr(){return!this.__axis}function Yr(t,e){var n=[],r=null,i=null,a=6,o=6,u=3,c=1===t||4===t?-1:1,s=4===t||2===t?"x":"y",l=1===t||3===t?Sr:Fr;function f(f){var h=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,d=null==i?e.tickFormat?e.tickFormat.apply(e,n):Nr:i,p=Math.max(a,0)+u,g=e.range(),m=+g[0]+.5,v=+g[g.length-1]+.5,y=(e.bandwidth?Er:Hr)(e.copy()),w=f.selection?f.selection():f,x=w.selectAll(".domain").data([null]),M=w.selectAll(".tick").data(h,e).order(),b=M.exit(),_=M.enter().append("g").attr("class","tick"),C=M.select("line"),T=M.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(_),C=C.merge(_.append("line").attr("stroke","currentColor").attr(s+"2",c*a)),T=T.merge(_.append("text").attr("fill","currentColor").attr(s,c*p).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),f!==w&&(x=x.transition(f),M=M.transition(f),C=C.transition(f),T=T.transition(f),b=b.transition(f).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=y(t))?l(t):this.getAttribute("transform")})),_.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return l(e&&isFinite(e=e(t))?e:y(t))}))),b.remove(),x.attr("d",4===t||2==t?o?"M"+c*o+","+m+"H0.5V"+v+"H"+c*o:"M0.5,"+m+"V"+v:o?"M"+m+","+c*o+"V0.5H"+v+"V"+c*o:"M"+m+",0.5H"+v),M.attr("opacity",1).attr("transform",(function(t){return l(y(t))})),C.attr(s+"2",c*a),T.attr(s,c*p).text(d),w.filter(Lr).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),w.each((function(){this.__axis=y}))}return f.scale=function(t){return arguments.length?(e=t,f):e},f.ticks=function(){return n=Ur.call(arguments),f},f.tickArguments=function(t){return arguments.length?(n=null==t?[]:Ur.call(t),f):n.slice()},f.tickValues=function(t){return arguments.length?(r=null==t?null:Ur.call(t),f):r&&r.slice()},f.tickFormat=function(t){return arguments.length?(i=t,f):i},f.tickSize=function(t){return arguments.length?(a=o=+t,f):a},f.tickSizeInner=function(t){return arguments.length?(a=+t,f):a},f.tickSizeOuter=function(t){return arguments.length?(o=+t,f):o},f.tickPadding=function(t){return arguments.length?(u=+t,f):u},f}function Or(t){return Yr(3,t)}function jr(t){return Yr(4,t)}const Vr={Occurrences:[null,12741,12906,12632,12192,12096,11673,11666,11411,11328,11246,10910,10611,10462,10364,10260,10086,9829,9746,9735,9538,9492,9207,9212,9179,9247,9042,9263,8889,9107,9111,8793,9059,9031,8983,8944,8925,9132,9208,9450,9530,9814,9842,9814,10075,10187,10220,10278,10446,10837,11027,11532,12362,12362],Registrations:[null,12142,13768,13162,12712,12147,11881,11562,11484,11143,11457,11153,10497,10057,10238,10452,10442,10386,9875,9526,10110,9879,8115,9906,9363,9337,9235,9138,9196,9054,8969,8966,9043,9022,9106,8206,9122,9267,9196,9305,9491,9774,9797,9706,9827,10249,10302,10328,10312,10646,10712,11537,7889,7889]},$r=["Care home","Home","Hospital","Other"],qr=dn("%Y-%m-%d"),zr=pn("%Y-%m-%d"),Ir=Ee(",d"),Rr=zr("2019-12-21"),Pr=[{label:"England and Wales",test:t=>!0},{label:"England",test:t=>/^E/.test(t)},{label:"Wales",test:t=>/^W/.test(t)}];let Zr;function Br(){const t={plot_type:ot("#plot_type").property("value"),area:ot("#area").property("value"),dataset:ot("#dataset").property("value"),start_date:zr(ot("#start_date").property("value")),stop_date:zr(ot("#stop_date").property("value"))};ot("#title").text(t.area);const e=Pr.map(t=>t.label).indexOf(t.area),n=e>=0?t=>Pr[e].test(t["admin-geography"]):e=>e.geography===t.area,r=Zr.filter(e=>n(e)&&e.registrationoroccurrence===t.dataset&&t.start_date<=e.date&&e.date<=t.stop_date);!function(t,e){const n={top:50,right:5,bottom:25,left:5},r=$r.length+1,i={top:50,right:0,bottom:30,left:70},a=(200+n.top+n.bottom)*r,o=ot("#by_place_of_death_plot").text("").append("svg").attr("height",a+i.top+i.bottom),u=ot("#by_place_of_death_plot").property("clientWidth")-i.left-i.right,c=u-n.left-n.right,s=o.attr("width",u+i.left+i.right).append("g").attr("transform",`translate(${i.left}, ${i.top})`),l=function(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let i=-1;for(let a of t)null!=(a=e(a,++i,t))&&(void 0===n?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}(e,t=>t.date);l[1]=en.offset(l[1],7);let f=0,h=0,d=0,p=0,g=0,m=0;const v=yt(e,t=>{const e=Ct(t,t=>"all-causes"===t["cause-of-death"]?t.v4_0:0),n=Ct(t,t=>"covid-19"===t["cause-of-death"]?t.v4_0:0),r=e-n,i=Ct(t,t=>"all-causes"===t["cause-of-death"]?t.fiveyearaverage:0),a=n+r-i;return f=Math.max(f,e,i),h=Math.min(h,a),d=Math.max(d,a),{covid:n,notcovid:r,baseline:i,excess:a}},t=>t.placeofdeath,t=>qr(t.date)),y=yt(e,t=>{const e=Ct(t,t=>"all-causes"===t["cause-of-death"]?t.v4_0:0),n=Ct(t,t=>"covid-19"===t["cause-of-death"]?t.v4_0:0),r=e-n,i=Ct(t,t=>"all-causes"===t["cause-of-death"]?t.fiveyearaverage:0),a=n+r-i;return m=Math.max(m,e,i),p=Math.min(p,a),g=Math.max(g,a),{covid:n,notcovid:r,baseline:i,excess:a}},t=>qr(t.date));{const t=16,e=20;let n=0;const r=s.append("g");r.append("rect").attr("class","covid").attr("x",n).attr("width",t).attr("height",t),n+=t+5,n+=r.append("text").attr("x",n).attr("dy","1em").text("COVID-19").node().getComputedTextLength()+e,r.append("rect").attr("class","notcovid").attr("x",n).attr("width",t).attr("height",t),n+=t+5,n+=r.append("text").attr("x",n).attr("dy","1em").text("COVID-19 not mentioned").node().getComputedTextLength()+e,r.append("line").attr("class","baseline").attr("y1",10).attr("y2",10).attr("x1",n).attr("x2",n+t),n+=t+5,n+=r.append("text").attr("x",n).attr("dy","1em").text("Five year average").node().getComputedTextLength(),r.attr("transform","translate(-55, -30)")}const w=s.selectAll(".place").data(["Total"].concat($r)).enter().append("g").attr("class","place").attr("transform",(t,e)=>`translate(${n.left}, ${e*a/r+n.top})`);w.append("text").attr("class","chart-title").attr("transform","translate(-60, -20)").text(String);const x=function(){return Tt.apply(Dr(cn,un,rn,en,tn,Ke,Ze,Pe,dn).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}().domain(l).rangeRound([0,c]),M=qe().domain("Total deaths"===t.plot_type?[0,f]:[h,d]).range([200,0]),b=qe().domain("Total deaths"===t.plot_type?[0,m]:[p,g]).range([200,0]),_=jr(M).ticks(5),C=jr(M).ticks(5).tickSize(-c),T=jr(b).ticks(5),A=jr(b).ticks(5).tickSize(-c),k=Or(x).ticks(un.every(1)),D=Or(x).ticks(un.every(1)).tickSize(-200);w.each((function(e,n){ot(this).append("g").attr("class","y-grid").call("Total"===e?A:C).call(t=>t.selectAll(".tick text").remove()).call(t=>t.selectAll(".domain").remove()),ot(this).append("g").attr("class","x-grid").attr("transform","translate(0,200)").call(D).call(t=>t.selectAll(".tick text").remove()).call(t=>t.selectAll(".domain").remove()),ot(this).append("g").attr("class","y-axis").call("Total"===e?T:_).call(t=>t.selectAll(".tick line").remove()).call(t=>t.selectAll(".domain").remove()),ot(this).append("text").attr("text-anchor","middle").attr("transform","translate(-60,100)rotate(-90)").attr("dy","1em").text("Deaths"),ot(this).append("g").attr("class","x-axis").attr("transform","translate(0,200)").call(k);const r="Total"===e?y:v.get(e),i=Array.from(r.entries()).sort((t,e)=>t[0]<e[0]?-1:1);i.forEach(t=>{const e=zr(t[0]);t.width=x(en.offset(e,7))-x(e)-1});const a=ot(this).selectAll(".bar").data(i).enter().append("g").attr("class","bar").attr("transform",t=>`translate(${x(zr(t[0]))})`),o="Total"===e?b:M;"Total deaths"===t.plot_type?(a.append("rect").attr("class","notcovid").attr("width",t=>t.width).attr("y",t=>Math.min(o(0),o(t[1].notcovid))).attr("height",t=>Math.abs(o(t[1].notcovid)-o(0))).append("title").text(t=>Ir(t[1].notcovid)),a.append("rect").attr("class","covid").attr("width",t=>t.width).attr("y",t=>Math.min(o(t[1].notcovid),o(t[1].covid+t[1].notcovid))).attr("height",t=>Math.abs(o(t[1].covid)-o(0))).append("title").text(t=>Ir(t[1].covid)),a.append("line").attr("class","baseline").attr("x2",t=>t.width).attr("y1",t=>o(t[1].baseline)).attr("y2",t=>o(t[1].baseline))):a.append("rect").attr("class","excess").attr("width",t=>t.width).attr("y",t=>Math.min(o(0),o(t[1].excess))).attr("height",t=>Math.abs(o(t[1].excess)-o(0))).append("title").text(t=>Ir(t[1].excess))}))}(t,r),function(t,e){const n=yt(e,t=>{const e=Ct(t,t=>"all-causes"===t["cause-of-death"]?t.v4_0:0),n=Ct(t,t=>"covid-19"===t["cause-of-death"]?t.v4_0:0);return{covid:n,notcovid:e-n,baseline:Ct(t,t=>"all-causes"===t["cause-of-death"]?t.fiveyearaverage:0)}},t=>t.placeofdeath),r=ot("#table").text("").append("table").attr("class","table shiny-table table-striped spacing-s");{const t=r.append("thead").append("tr");["Place of death","All causes","COVID-19","COVID-19 not mentioned","Five year average","Excess deaths","non-COVID excess"].forEach((e,n)=>{t.append("th").classed("right",n>0).text(e)})}const i=r.append("tbody"),a={covid:0,notcovid:0,baseline:0};$r.forEach(t=>{const e=n.get(t),r=e.covid+e.notcovid,o=i.append("tr");o.append("td").text(t),o.append("td").classed("right",!0).text(Ir(r)),o.append("td").classed("right",!0).text(Ir(e.covid)),o.append("td").classed("right",!0).text(Ir(e.notcovid)),o.append("td").classed("right",!0).text(Ir(e.baseline)),o.append("td").classed("right",!0).text(Ir(r-e.baseline)),o.append("td").classed("right",!0).text(Ir(e.notcovid-e.baseline)),a.covid+=e.covid,a.notcovid+=e.notcovid,a.baseline+=e.baseline});{const t=a,e=t.covid+t.notcovid,n=i.append("tr");n.append("td").text("Total"),n.append("td").classed("right",!0).text(Ir(e)),n.append("td").classed("right",!0).text(Ir(t.covid)),n.append("td").classed("right",!0).text(Ir(t.notcovid)),n.append("td").classed("right",!0).text(Ir(t.baseline)),n.append("td").classed("right",!0).text(Ir(e-t.baseline)),n.append("td").classed("right",!0).text(Ir(t.notcovid-t.baseline))}}(0,r),function(t){const e=en.offset(t.stop_date,6);ot("#table_caption").text(`Table of COVID and non-COVID deaths (${t.dataset}) within ${t.area} by place of death from ${qr(t.start_date)} till ${qr(e)} (inclusive), with excess deaths calculated against a five year average. In accordance with the ONS, due to the impact of coronavirus, the five year average being used as a baseline in 2021 is the same as that for 2020, and runs from 2015 to 2019.`)}(t)}fetch("data.csv").then(t=>t.text()).then(t=>{let e=dt(t),n=0;e.forEach(t=>{t.v4_0=+t.v4_0,t.week=+t.week,n=Math.max(t.week,n),t.date=en.offset(Rr,7*t.week)});const r=function(t){const e=t.filter(t=>"Occurrences"===t.registrationoroccurrence&&t.week<=10),n=Ct(e,t=>"all-causes"===t["cause-of-death"]?t.v4_0:0);return yt(e,t=>Ct(t,t=>"all-causes"===t["cause-of-death"]?t.v4_0:0)/n,t=>t.geography,t=>t.placeofdeath)}(e);e.forEach(t=>{t.fiveyearaverage="all-causes"===t["cause-of-death"]?Vr[t.registrationoroccurrence][1+(t.week-1)%53]*r.get(t.geography).get(t.placeofdeath):0}),Zr=e;{const t=Array.from(r.keys()).sort();ot("#area").append("optGroup").attr("label","Regions").selectAll("option").data(Pr).enter().append("option").property("value",t=>t.label).text(t=>t.label),ot("#area").append("optGroup").attr("label","Local authorities").selectAll("option").data(t).enter().append("option").property("value",String).text(String);const e=[];for(let t=1;t<=n;++t)e.push(en.offset(Rr,7*t));ot("#start_date").selectAll("option").data(e).enter().append("option").property("value",qr).text(qr),ot("#start_date").property("value","2020-02-29"),ot("#stop_date").selectAll("option").data(e).enter().append("option").property("value",qr).text(qr),ot("#stop_date").property("value",qr(e.pop())),$("select").selectize({onChange:Br})}ot(window).on("resize",Br),Br()})}));
